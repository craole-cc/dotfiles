#!/bin/sh

scr_NAME="runsh"

display_usage_guide() {
  printf "Usage: %s [options] [script1] [script2] ...\n" "$scr_NAME"
  printf "Options:\n"
  printf "  --help\tDisplay this usage guide\n"
}

validate_path() {
  #@ Check if the target is a valid file
  [ -f "$1" ] || {
    printf "Invalid or missing file: %s\n" "$1"
    exit 1
  }
}

access_directory() {
  {
    #@ Change to the target directory
    cd "$1" &&
      #@ verify the current directory is the same as the target
      [ "$PWD" = "$1" ]
  } || {
    printf "Failed to access target: %s\n" "$1"
    exit 1
  }
}

execute_script() {
  #@ Execute the target script
  [ -f "$1" ] && sh "$1"
}

main() {
  #@ Check if any arguments are provided
  [ "$#" -eq 0 ] && {
    display_usage_guide
    exit 1
  }

  #@ Process each argument
  while [ "$#" -ge 1 ]; do
    case "$1" in
    -h | --help) display_usage_guide ;;
    *)
      #@ Validate the script file
      validate_path "$1"

      #@ Access the script's directory
      access_directory "$(dirname -- "$1")"

      #@ Execute the script
      execute_script "$(basename -- "$1")"
      ;;
    esac
    shift
  done
}

#@ Invoke the main function
main "$@"
